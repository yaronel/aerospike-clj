<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title># Implementing `IAerospikeClient`</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Aerospike-clj</span> <span class="project-version">0.3.6</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="advanced-async-hooks.html"><div class="inner"><span># Advanced asynchronous hooks:</span></div></a></li><li class="depth-1  current"><a href="implementing-clients.html"><div class="inner"><span># Implementing `IAerospikeClient`</span></div></a></li><li class="depth-1 "><a href="tutorial.html"><div class="inner"><span>Tutorial</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>aerospike-clj</span></div></div></li><li class="depth-2 branch"><a href="aerospike-clj.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="aerospike-clj.metrics.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>metrics</span></div></a></li><li class="depth-2 branch"><a href="aerospike-clj.policy.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>policy</span></div></a></li><li class="depth-2"><a href="aerospike-clj.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h2><a href="#implementing" name="implementing"></a>Implementing <code>IAerospikeClient</code></h2>
<p>An exmaple of how to implement, for example a simple sharding client, that talks to several separate clusters:</p>
<pre><code class="clojure">(defrecord ShardedAerospikeClient [^"[Lcom.aerospike.client.AerospikeClient;" acs
                                   ^int shards
                                   ^EventLoop el
                                   ^String dbns
                                   ^String cluster-name
  aero/IAerospikeClient
  (get-client ^AerospikeClient [_ index] (get acs (mod (hash index) shards)))
  (get-client ^AerospikeClient [_] [(first acs)])
  (get-all-clients [_] acs))
</code></pre>
<p>Then, a factory function creating one would look like:</p>
<pre><code class="clojure">(defn init-sharded-aerospike-client
  [hosts aero-ns conf]
   (let [cluster-name "sharded-99"
         event-loops (:event-loops conf (aero/create-event-loops conf))
         client-policy (aero/create-client-policy event-loops conf)
         clients (into-array AerospikeClient (map #(aero/create-client % client-policy) hosts))]
     (println (format ";; Starting aerospike clients for clusters %s" cluster-name ))
     (map-&gt;ShardedAerospikeClient {:acs clients
                                   :shards (count clients)
                                   :el event-loops
                                   :dbns aero-ns
                                   :cluster-name cluster-name})))
</code></pre></div></div></div></body></html>